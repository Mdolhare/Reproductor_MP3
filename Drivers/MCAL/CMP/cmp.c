/*******************************************************************************
  @file     dma.c
  @brief    Driver para DMA
  @author   GRUPO 2
 ******************************************************************************/
/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/

#include "../SDK/CMSIS/MK64F12.h"
#include "cmp.h"
#include "hardware.h"

/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/
#define CANT_CMP 3
#define DAC_LEVEL 29// Vin/64 * (DAC_LEVEL + 1)
#define DAC_IN IN7

/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/



/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/


/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/




/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/
static CMP_Type * const cmp_base[CANT_CMP] = CMP_BASE_PTRS;

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/


/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
void CMP_init(CMPn_t cmp_id, INn_t in, CMP_Pin_t pin) {
	SIM->SCGC4 |= SIM_SCGC4_CMP_MASK;

	CMP_t cmp = cmp_base[cmp_id];

	cmp ->CR0 |= CMP_CR0_HYSTCTR(level2);
	cmp ->CR1 |= CMP_CR1_PMODE_MASK;
	cmp ->DACCR |= CMP_DACCR_DACEN_MASK | CMP_DACCR_VOSEL(DAC_LEVEL) | CMP_DACCR_VRSEL_MASK;
	*PCR_ADRESS(pin) = PORT_PCR_MUX(PORT_mAnalog);

	cmp ->MUXCR |= CMP_MUXCR_MSEL(DAC_IN) | CMP_MUXCR_PSEL(in) ;
	cmp ->CR1 |= CMP_CR1_EN_MASK;
}

bool CMP_get_cout()
{
	bool cout = (CMP1 ->SCR) & CMP_SCR_COUT_MASK;
	return cout;
}

/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
