/***************************************************************************//**
  @file     ModemRxUART_V2.h
  @brief    modulo para mandar recibir datos tipo uart
  @author   Grupo 2
 ******************************************************************************/
/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/
#include "ModemRxUART_V2.h"
#include "Decodificador.h"
#include "cmp.h"

/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/
#define LS_BYTE_MASK (0x00FF)
#define NUM_DATA_BITS (8)
/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/

/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/


/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/
static uint8_t data;
static uint8_t parity;
/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
void modemRxUart_Init(){
	//init modulo CMP
	CMP_init(CMP_0, IN1, PTC7_CMP0_IN1);

	//init Decodificador
	Dec_Init(DEC_CMP0);


}

bool modemRxUart_isNewData(){
	uint16_t bitStream = 0;
	if(Dec_isNewFrame()){
		bitStream = Dec_isNewFrame();
		data = (bitStream >> 1) & LS_BYTE_MASK;
		parity = (bitStream >> (NUM_DATA_BITS+1)) & 1;
		return true;
	}
	else{
		return false;
	}
}

uint16_t modemRxUart_getData(){
	return data;
}

uint16_t modemRxUart_getParity(){
	return parity;
}
/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
